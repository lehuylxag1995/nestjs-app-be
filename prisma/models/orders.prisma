enum OrderStatus {
    //  1. Khi khách đặt hàng (CREATE)
    // Trạng thái: PENDING (hoặc NEW, UNCONFIRMED)
    // Lý do: Mới tạo, chưa được xác nhận hay xử lý.
    PENDING

    // 2. Khi shop xác nhận đơn
    // Trạng thái: CONFIRMED / PROCESSING
    // Xảy ra khi: Shop kiểm tra hàng, xác nhận thông tin khách, chốt đơn.
    // Có thể kèm logic:
    // Giữ hàng trong kho (reduce stock).
    // Gửi email/sms xác nhận.
    // InventoryTransaction : Type = RESERVE
    CONFIRMED

    // 3. Khi bắt đầu giao hàng
    // Trạng thái: SHIPPED
    // Xảy ra khi: Đơn đã được bàn giao cho đơn vị vận chuyển.
    // Có thể lưu tracking number từ đối tác giao hàng.
    // InventoryTransaction : Type = EXPORT
    SHIPPED

    // 4. Khi giao thành công
    // Trạng thái: DELIVERED
    // Xảy ra khi: Khách nhận hàng và ký nhận.
    // Nếu là COD: cập nhật thêm trạng thái thanh toán PAID.
    DELIVERED

    //5. Khi hủy đơn
    // Trạng thái: CANCELLED
    // Lý do: Khách yêu cầu hủy, shop hết hàng, hoặc thanh toán thất bại.
    // Nếu đã trừ kho, cần trả lại số lượng.
    // InventoryTransaction: Nếu Type = EXPORT -> type = RETURN, 
    //                       Nếu Type = RESERVE -> type = RELEASE
    CANCELLED

    // 6. Khi hoàn hàng
    // Trạng thái: RETURNED hoặc REFUNDED
    // Xảy ra khi khách trả lại hàng sau khi nhận.
    // InventoryTransaction: Type = RETURN
    RETURNED
}

model Order {
    id        String      @id @default(uuid())
    status    OrderStatus @default(PENDING)
    total     Decimal     @default(0) @db.Decimal(13, 3) // Tổng bill đơn hàng
    userId    String // Thông tin khách hàng
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt

    User                  User                   @relation(fields: [userId], references: [id])
    Items                 OrderItem[]
    InventoryTransactions InventoryTransaction[]

    @@map("Orders")
}

model OrderItem {
    id               String  @id @default(uuid())
    orderId          String
    productId        String
    variantId        String
    quantity         Int
    listedPrice      Decimal @db.Decimal(13, 3) //Giá niêm yết (giá bán gồm khuyến mãi)
    totalListedPrice Decimal @db.Decimal(13, 3) //Thành tiền giá bán
    costPrice        Decimal @db.Decimal(13, 3) //Giá vốn tại thời điểm bán
    totalCostPrice   Decimal @db.Decimal(13, 3) //Thành tiền giá vốn

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    Order           Order          @relation(fields: [orderId], references: [id])
    Product         Product        @relation(fields: [productId], references: [id])
    ProductVariants ProductVariant @relation(fields: [variantId], references: [id])

    @@map("OrderItems")
}
